---
layout: post
title:  "Fabric使用说明"
date:   2017-09-05 10:54:00 +0800
categories: Python
---

## 基本说明

新建`fabfile.py`，定义函数，如`foo`，保存后执行`fab foo`即可

## Operations

```
from fabric.api import *

get(*args, **kwargs)
# Download one or more files from a remote host.

put(*args, **kwargs)
# Upload one or more files to a remote host.

local(command, capture=False, shell=None)
# Run a command on the local system.

run(*args, **kwargs)
# Run a shell command on a remote host.

sudo(*args, **kwargs)
# Run a shell command on a remote host, with superuser privileges.

prompt(text, key=None, default='', validate=None)
# Prompt user with text and return the input (like raw_input).

open_shell(*args, **kwargs)
# Invoke a fully interactive shell on the remote end.

reboot(*args, **kwargs)
# Reboot the remote system.

require(*keys, **kwargs)
# Check for given keys in the shared environment dict and abort if not found.

```
## Context Managers

```
from fabric.api import *

cd(path)
# Context manager that keeps directory state when calling remote operations.

lcd(path)
# Context manager for updating local current working directory.

prefix(command)
# Prefix all wrapped run/sudo commands with given command plus &&.

path(path, behavior='append')
# Append the given path to the PATH used to execute any wrapped commands.

settings(*args, **kwargs)
#Nest context managers and/or override env variables.

warn_only()
#Alias to settings(warn_only=True).

hide(*args, **kwds)
# Context manager for setting the given output groups to False.

quiet()
#Alias to settings(hide('everything'), warn_only=True).

remote_tunnel(*args, **kwds)
#Create a tunnel forwarding a locally-visible port to the remote target.

shell_env(**kw)
#Set shell environment variables for wrapped commands.

```

## Decorators

```
from fabric.api import *

hosts(*host_list)
# Decorator defining which host or hosts to execute the wrapped function on.

parallel(pool_size=None)
# Forces the wrapped function to run in parallel, instead of sequentially.

roles(*role_list)
# Decorator defining a list of role names, used to look up host lists.

runs_once(func)
# Decorator preventing wrapped function from running more than once.

serial(func)
# Forces the wrapped function to always run sequentially, never in parallel.

task(*args, **kwargs)
# Decorator declaring the wrapped function to be a new-style task.

with_settings(*arg_settings, **kw_settings)
# Decorator equivalent of fabric.context_managers.settings.

```

## Utils

```
from fabric.api import *

abort(msg)
# Abort execution, print msg to stderr and exit with error status (1.)

fastprint(text, show_prefix=False, end='', flush=True)
# Print text immediately, without any prefix or line ending.

puts(text, show_prefix=None, end='\n', flush=False)
# An alias for print whose output is managed by Fabric’s output controls.

warn(msg)
# Print warning message, but do not abort execution.

```

## Console Output Utilities

```
fabric.contrib.console.confirm(question, default=True)
# Ask user a yes/no question and return their response as True or False.

```

## color

```
from fabric.colors import *

blue(text, bold=False)
cyan(text, bold=False)
green(text, bold=False)
magenta(text, bold=False)
red(text, bold=False)
white(text, bold=False)
yellow(text, bold=False)

```

## File and Directory Management

```
from fabric.contrib.files import *

append(filename, text, use_sudo=False, partial=False, escape=True, shell=False)
# Append string (or list of strings) text to filename.

comment(filename, regex, use_sudo=False, char='#', backup='.bak', shell=False)
# Attempt to comment out all lines in filename matching regex.

uncomment(filename, regex, use_sudo=False, char='#', backup='.bak', shell=False)
# Attempt to uncomment all lines in filename matching regex.

contains(filename, text, exact=False, use_sudo=False, escape=True, shell=False, case_sensitive=True)
# Return True if filename contains text (which may be a regex.)

exists(path, use_sudo=False, verbose=False)
# Return True if given path exists on the current remote host.

first(*args, **kwargs)
# Given one or more file paths, returns first one found, or None if none exist. May specify use_sudo and verbose which are passed to exists.

is_link(path, use_sudo=False, verbose=False)
# Return True if the given path is a symlink on the current remote host.

is_win()
# Return True if remote SSH server is running Windows, False otherwise.

sed(filename, before, after, limit='', use_sudo=False, backup='.bak', flags='', shell=False)
# Run a search-and-replace on filename with given regex patterns.

.upload_template(filename, destination, context=None, use_jinja=False, template_dir=None, use_sudo=False, backup=True, mirror_local_mode=False, mode=None, pty=None, keep_trailing_newline=False, temp_dir='')
# Render and upload a template text file to a remote host.

```
